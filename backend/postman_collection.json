{
  "info": {
    "name": "RAG Chatbot Backend",
    "description": "Postman collection for RAG backend upload -> process -> chat workflow.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "version": "1.1.0"
  },
  "item": [
    {
      "name": "Health Basic",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/health",
          "host": ["{{base_url}}"],
          "path": ["health"]
        }
      },
      "response": []
    },
    {
      "name": "Health Verbose",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/health?verbose=1",
          "host": ["{{base_url}}"],
          "path": ["health"],
          "query": [{ "key": "verbose", "value": "1" }]
        }
      },
      "response": []
    },
    {
      "name": "Documents Upload",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "const res = pm.response.json();",
              "if (res.uploaded && res.uploaded.length>0){ pm.collectionVariables.set('document_id', res.uploaded[0].document_id); }"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [],
        "body": {
          "mode": "formdata",
          "formdata": [
            { "key": "files", "type": "file", "src": ["sample.pdf"] }
          ]
        },
        "url": {
          "raw": "{{base_url}}/documents/upload?auto_process=true",
          "host": ["{{base_url}}"],
          "path": ["documents", "upload"],
          "query": [{ "key": "auto_process", "value": "true" }]
        }
      },
      "response": []
    },
    {
      "name": "Document Status",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/documents/{{document_id}}/status",
          "host": ["{{base_url}}"],
          "path": ["documents", "{{document_id}}", "status"]
        }
      },
      "response": []
    },
    {
      "name": "Document Process (Force Reprocess)",
      "request": {
        "method": "POST",
        "header": [],
        "url": {
          "raw": "{{base_url}}/documents/{{document_id}}/process",
          "host": ["{{base_url}}"],
          "path": ["documents", "{{document_id}}", "process"]
        }
      },
      "response": []
    },
    {
      "name": "Chat Ask",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "const res = pm.response.json();",
              "if (res.conversation_id) pm.collectionVariables.set('conversation_id', res.conversation_id);",
              "pm.test('Answer present', function(){ pm.expect(res.answer).to.be.a('string');});"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [{ "key": "Content-Type", "value": "application/json" }],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"query\": \"What does the document mention?\",\n  \"top_k\": 3\n}"
        },
        "url": {
          "raw": "{{base_url}}/chat",
          "host": ["{{base_url}}"],
          "path": ["chat"]
        }
      },
      "response": []
    },
    {
      "name": "Chat Follow-up",
      "request": {
        "method": "POST",
        "header": [{ "key": "Content-Type", "value": "application/json" }],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"query\": \"Give a shorter answer\",\n  \"conversation_id\": \"{{conversation_id}}\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/chat",
          "host": ["{{base_url}}"],
          "path": ["chat"]
        }
      },
      "response": []
    },
    {
      "name": "Chat History",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/chat/history?conversation_id={{conversation_id}}",
          "host": ["{{base_url}}"],
          "path": ["chat", "history"],
          "query": [
            { "key": "conversation_id", "value": "{{conversation_id}}" }
          ]
        }
      },
      "response": []
    },
    {
      "name": "Chat Clear",
      "request": {
        "method": "DELETE",
        "header": [],
        "url": {
          "raw": "{{base_url}}/chat/clear/{{conversation_id}}",
          "host": ["{{base_url}}"],
          "path": ["chat", "clear", "{{conversation_id}}"]
        }
      },
      "response": []
    },
    {
      "name": "Documents List",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/documents",
          "host": ["{{base_url}}"],
          "path": ["documents"]
        }
      },
      "response": []
    },
    {
      "name": "Document Delete",
      "event": [
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [
              "pm.test('Deleted OK', function(){ pm.expect(pm.response.code).to.be.oneOf([200,404]);});"
            ]
          }
        }
      ],
      "request": {
        "method": "DELETE",
        "header": [],
        "url": {
          "raw": "{{base_url}}/documents/{{document_id}}",
          "host": ["{{base_url}}"],
          "path": ["documents", "{{document_id}}"]
        }
      },
      "response": []
    },
    {
      "name": "Retrieve (Semantic)",
      "request": {
        "method": "POST",
        "header": [{ "key": "Content-Type", "value": "application/json" }],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"query\": \"Test semantic retrieval\",\n  \"top_k\": 5\n}"
        },
        "url": {
          "raw": "{{base_url}}/retrieve",
          "host": ["{{base_url}}"],
          "path": ["retrieve"]
        }
      },
      "response": []
    },
    {
      "name": "Chat Clarify (Broad Query)",
      "request": {
        "method": "POST",
        "header": [{ "key": "Content-Type", "value": "application/json" }],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"query\": \"what is this?\",\n  \"top_k\": 5,\n  \"min_score\": 0.35\n}"
        },
        "url": {
          "raw": "{{base_url}}/chat",
          "host": ["{{base_url}}"],
          "path": ["chat"]
        }
      },
      "response": []
    },
    {
      "name": "Conversation Set Documents",
      "request": {
        "method": "PATCH",
        "header": [{ "key": "Content-Type", "value": "application/json" }],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"document_ids\": [\"{{document_id}}\"]\n}"
        },
        "url": {
          "raw": "{{base_url}}/chat/documents/{{conversation_id}}",
          "host": ["{{base_url}}"],
          "path": ["chat", "documents", "{{conversation_id}}"]
        }
      },
      "response": []
    }
  ],
  "variable": [
    { "key": "base_url", "value": "http://localhost:8000" },
    { "key": "conversation_id", "value": "" },
    { "key": "document_id", "value": "" }
  ]
}
